# SPLIT-PLAN-002: Kind Cluster Integration
## Split 002 of 5: Kind and Kubernetes Operations
**Planner**: Code Reviewer code-reviewer-1757726063 (sole planner for ALL splits)
**Parent Effort**: kind-cert-extraction

<!-- ORCHESTRATOR METADATA PLACEHOLDER - DO NOT REMOVE -->
<!-- The orchestrator will add infrastructure metadata below: -->
<!-- WORKING_DIRECTORY, BRANCH, REMOTE, BASE_BRANCH, etc. -->
<!-- SW Engineers MUST read this metadata to navigate to the correct directory -->
<!-- END PLACEHOLDER -->

## Boundaries (CRITICAL: All splits MUST reference SAME effort!)
- **Previous Split**: Split 001 of phase1/wave1/kind-cert-extraction
  - Path: efforts/phase1/wave1/kind-cert-extraction/split-001/
  - Branch: idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-001
  - Summary: Core certificate extraction types and interfaces
- **This Split**: Split 002 of phase1/wave1/kind-cert-extraction
  - Path: efforts/phase1/wave1/kind-cert-extraction/split-002/
  - Branch: idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-002
- **Next Split**: Split 003 of phase1/wave1/kind-cert-extraction
  - Path: efforts/phase1/wave1/kind-cert-extraction/split-003/
  - Branch: idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-003
- **File Boundaries**:
  - This Split Start: pkg/kind/cluster.go
  - This Split End: pkg/k8s/ (all files)
  - Next Split Start: pkg/build/build.go

## Files in This Split (EXCLUSIVE - no overlap with other splits)
### Kind Package (pkg/kind/)
- pkg/kind/cluster.go (~285 lines)
- pkg/kind/node.go (~150 lines)
- pkg/kind/config.go (~100 lines)
- pkg/kind/errors.go (~50 lines)
- Test files for kind package

### Kubernetes Package (pkg/k8s/)
- pkg/k8s/client.go (~120 lines)
- pkg/k8s/pod.go (~80 lines)  
- pkg/k8s/namespace.go (~60 lines)
- pkg/k8s/secret.go (~90 lines)
- Test files for k8s package

## Functionality
This split provides Kind cluster and Kubernetes operations:
- Kind cluster management and detection
- Node operations for Kind clusters
- Kubernetes client initialization
- Pod operations (finding, exec, copy)
- Namespace operations
- Secret management
- Integration with kubectl

## Dependencies
- **Split 001**: Uses certificate types and interfaces
- Imports types from pkg/certs (from Split 001)
- Implements KindClient interface defined in Split 001

## Implementation Instructions
1. **Setup**:
   ```bash
   # Branch from Split 001
   cd efforts/phase1/wave1/kind-cert-extraction/split-002
   git checkout -b idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-002
   
   # Cherry-pick or merge Split 001 interfaces
   git cherry-pick [split-001-commits]
   ```

2. **Implementation**:
   - Implement complete pkg/kind package
   - Implement complete pkg/k8s package
   - Ensure proper error handling
   - Add retry logic for cluster operations
   - Implement kubectl exec functionality

3. **Integration with Split 001**:
   - Import certificate types from pkg/certs
   - Implement KindClient interface
   - Use error types from Split 001
   - Maintain interface compatibility

4. **Testing**:
   - Mock Kubernetes client for unit tests
   - Test cluster detection logic
   - Test pod operations
   - Validate error scenarios

5. **Validation**:
   ```bash
   # Measure size
   $PROJECT_ROOT/tools/line-counter.sh
   
   # Run tests
   go test ./pkg/kind/... ./pkg/k8s/...
   
   # Build verification
   go build ./...
   ```

## Size Management
- **Target Size**: 680 lines
- **Hard Limit**: 800 lines
- **Measurement**: Use ${PROJECT_ROOT}/tools/line-counter.sh
- **Excluded**: Test files, generated code

## Feature Flags
- `KIND_CLUSTER_OPS_ENABLED`: Enable Kind operations
- Must gracefully handle missing clusters
- Fallback to mock operations when disabled

## Quality Requirements
- Comprehensive error handling for cluster operations
- No stub implementations (R320)
- Test coverage >80%
- Proper timeout handling
- Clear logging for debugging

## Integration Points
This split provides for other splits:
- Kind cluster detection and management
- Kubernetes client operations
- Pod exec capabilities
- Certificate copy from pods
- Namespace and secret management

## Success Criteria
- ✅ Complete Kind cluster operations
- ✅ Full Kubernetes client implementation
- ✅ Tests passing with >80% coverage
- ✅ Size under 700 lines
- ✅ No stub implementations
- ✅ Proper integration with Split 001
- ✅ Feature flags working correctly