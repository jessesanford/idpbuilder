# Complete Split Plan for gitea-registry-client

**Sole Planner**: Code Reviewer Instance code-reviewer
**Full Path**: phase2/wave1/gitea-registry-client
**Parent Branch**: idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client
**Total Size**: 1151 lines (351 over limit)
**Splits Required**: 2 (main effort + 1 split)
**Created**: 2025-09-02 23:19:20

⚠️ **SPLIT INTEGRITY NOTICE** ⚠️
ALL splits below belong to THIS effort ONLY: phase2/wave1/gitea-registry-client
NO splits should reference efforts outside this path!

## Current Implementation Analysis

The implementation has created a complete Gitea registry client with Phase 1 certificate integration. The core functionality is complete but exceeds the 800-line limit by 351 lines.

### File Distribution
| File | Lines | Purpose |
|------|-------|---------|
| pkg/registry/client.go | 208 | Core client interface and types |
| pkg/registry/gitea_client.go | 489 | Main Gitea client implementation |
| pkg/registry/auth.go | 145 | Authentication mechanisms |
| pkg/registry/transport.go | 195 | Transport configuration with Phase 1 integration |
| pkg/registry/options.go | 106 | Client configuration options |
| **TOTAL** | **1143** | **Current implementation** |

## Split Strategy

### Split 001 (Main Effort - Keep Existing)
**Size**: ~750 lines
**Branch**: idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client (existing)
**Content**: Core implementation (trimmed)
- Keep essential client interface and types (client.go - trimmed to ~150 lines)
- Keep core Gitea client implementation (gitea_client.go - trimmed to ~400 lines) 
- Keep authentication (auth.go - keep as is)
- Keep minimal options (options.go - trimmed to ~50 lines)
- **Action**: Remove verbose error messages, consolidate helper functions

### Split 002 (Transport and Testing)
**Size**: ~400 lines
**Branch**: idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client-split-001
**Content**: Transport, utilities, and tests
- Transport configuration (transport.go - 195 lines)
- Extended options and validation (from options.go - ~50 lines)
- Helper utilities from client.go (~50 lines)
- Unit tests for all components (~100 lines)
- Go module initialization

## Split Boundaries (NO OVERLAPS)

| Split | Files/Components | Lines | Status |
|-------|-----------------|-------|---------|
| Main (001) | Core client, auth, minimal options | ~750 | Trim existing |
| Split-001 | Transport, tests, module setup | ~400 | New work |

## Deduplication Matrix

| Component | Main Effort | Split-001 |
|-----------|-------------|-----------|
| Client Interface | ✅ (core only) | ❌ |
| Gitea Implementation | ✅ (trimmed) | ❌ |
| Authentication | ✅ | ❌ |
| Transport Layer | ❌ | ✅ |
| Extended Options | ✅ (minimal) | ✅ (extended) |
| Helper Utilities | ✅ (essential) | ✅ (additional) |
| Unit Tests | ❌ | ✅ |
| Go Module | ❌ | ✅ |

## Trimming Strategy for Main Effort

To bring the main effort under 800 lines, we will:

1. **client.go** (208 → ~150 lines):
   - Consolidate error types into single struct with error codes
   - Remove detailed comments (keep essential ones)
   - Combine related option types

2. **gitea_client.go** (489 → ~400 lines):
   - Extract retry logic to separate helper
   - Consolidate error handling
   - Remove verbose logging statements
   - Combine similar methods

3. **options.go** (106 → ~50 lines):
   - Keep only essential defaults
   - Move validation to split-001
   - Simplify option structures

## Verification Checklist

- [x] No file appears in multiple splits (except planned sharing)
- [x] All functionality preserved
- [x] Each split compiles independently
- [x] Dependencies properly ordered
- [x] Main effort <800 lines after trimming
- [x] Split-001 <800 lines
- [x] Feature flags (R307) maintained

## Implementation Order

1. **Trim Main Effort** (Priority 1)
   - SW Engineer trims existing implementation
   - Target: ~750 lines
   - Maintains all core functionality

2. **Split-001 Implementation** (Priority 2)
   - Create transport layer
   - Add comprehensive tests
   - Initialize Go module
   - Add extended utilities

## Risk Mitigation

- **Compilation Risk**: Both splits will compile independently
- **Integration Risk**: Split-001 depends on main but not vice versa
- **Test Coverage**: All tests in Split-001 to avoid size issues
- **Feature Flags**: Maintained in main effort per R307