# ORCHESTRATOR STATE: SPAWN_CODE_REVIEWER_PROJECT_TEST_PLANNING

## Overview
This state spawns a Code Reviewer to create project-level tests from the master architecture, implementing TDD at the project level per R341.

## Entry Criteria
- Master architecture exists (PROJECT-ARCHITECTURE.md or MASTER-ARCHITECTURE.md)
- Transitioned from WAITING_FOR_MASTER_ARCHITECTURE
- No existing PROJECT-TEST-PLAN.md

## State Responsibilities

### 1. Verify Architecture Exists
```bash
# Ensure we have architecture to work from
if [ ! -f "PROJECT-ARCHITECTURE.md" ] && [ ! -f "MASTER-ARCHITECTURE.md" ]; then
    echo "‚ùå Cannot create tests without master architecture!"
    exit 341
fi
```

### 2. Spawn Code Reviewer for Test Planning
```bash
/spawn-agent code-reviewer \
    --state PROJECT_TEST_PLANNING \
    --task "Create project-level tests from master architecture" \
    --tdd "Tests must be created BEFORE Phase 1 implementation per R341"
```

### 3. Record Spawn with R151 Timing
```bash
# Track spawn time for R151 compliance
SPAWN_TIME=$(date +%s)
yq -i '.spawned_agents.project_test_reviewer.id = "'$AGENT_ID'"' orchestrator-state.json
yq -i '.spawned_agents.project_test_reviewer.timestamp = "'$SPAWN_TIME'"' orchestrator-state.json
yq -i '.spawned_agents.project_test_reviewer.state = "PROJECT_TEST_PLANNING"' orchestrator-state.json
```

### 4. Update State and Stop (R313)
```bash
update_state "WAITING_FOR_PROJECT_TEST_PLAN"
save_todos "Spawned Code Reviewer for project test planning"
git add orchestrator-state.json todos/
git commit -m "state: spawned code reviewer for project tests (R341 TDD)"
git push
echo "üõë Stopping per R313 after spawn"
```

## Exit Criteria
- Code Reviewer spawned for PROJECT_TEST_PLANNING
- State file updated to WAITING_FOR_PROJECT_TEST_PLAN
- R313: MUST stop after spawning

## Success Metrics
- ‚úÖ Code Reviewer spawned within 5s (R151)
- ‚úÖ State updated before stop (R324)
- ‚úÖ R341 TDD compliance tracked
- ‚úÖ TODOs saved (R287)

## Related Rules
- R341: TDD - tests before implementation
- R342: Early branch creation for test storage
- R151: Parallel agent timing
- R313: Mandatory stop after spawn
- R324: State update before stop