# FIX PLAN: BUG-cascade-20251005-013208-001

## Bug Identification

**Bug ID**: BUG-cascade-20251005-013208-001
**Cascade ID**: cascade-20251005-013208
**Severity**: CRITICAL
**Detected At**: 2025-10-04T15:56:01Z
**Detected By**: R291 Build Gate - Phase 1 Wave 2 Integration
**Category**: build_failure

### Error Description
```
PushCmd redeclared
```

### File Locations
- **Primary**: `pkg/cmd/push/root.go:13:5`
- **Conflict**: `pkg/cmd/push/push.go:18:5`

### Affected Effort
- **Effort ID**: E1.2.1-command-structure
- **Branch**: idpbuilder-push-oci/phase1/wave2/command-structure
- **Path**: efforts/phase1/wave2/E1.2.1-command-structure

## Root Cause Analysis

### What Caused the Duplicate Error
During the integration of Wave 2 efforts, two separate files were created that both declare `var PushCmd`:

1. **root.go** (line 13): Declares `PushCmd` with authentication support
   - Includes auth.AddAuthenticationFlags integration
   - Has verbose and insecure flags
   - Simpler command structure

2. **push.go** (line 18): Declares `PushCmd` with different implementation
   - Different flag definitions (const insecureUsage)
   - Different command structure
   - Different RunE function (pushRun)

### Why It Wasn't Caught Earlier
This is a **merge conflict** that occurred during Wave 2 integration when combining:
- Original effort implementation (one file approach)
- Split effort contributions (different file organization)

The duplicate declarations only manifest when files are combined in the integration workspace.

### Files Involved
- `pkg/cmd/push/root.go` - Contains first PushCmd declaration
- `pkg/cmd/push/push.go` - Contains duplicate PushCmd declaration
- Both files are in the **integration workspace**, not the original effort

## Fix Strategy

### Approach: Consolidate into Single Declaration
**Remove the duplicate by keeping the more complete implementation**

#### Decision: Keep root.go, Remove push.go Declaration
**Reasoning**:
- `root.go` has more complete integration (auth flags, proper helpers)
- `root.go` follows cobra best practices with init() function
- `push.go` appears to be an incomplete/alternative implementation

### Files to Modify
**In the original effort directory** (`efforts/phase1/wave2/E1.2.1-command-structure/`):

1. **DELETE or RENAME**: `pkg/cmd/push/push.go`
   - This file contains the duplicate PushCmd declaration
   - If it has other useful code, extract that code first
   - The insecure flag logic is already in root.go

2. **VERIFY**: `pkg/cmd/push/root.go`
   - Ensure it's the only file with PushCmd declaration
   - Ensure all necessary flags are present
   - Ensure RunE function is complete

### Expected Outcome
After fix:
- Only ONE `var PushCmd` declaration exists in the package
- All necessary functionality is preserved in root.go
- Integration workspace will successfully compile
- No duplicate symbol errors

## Implementation Steps

### Step 1: Navigate to Effort Directory
```bash
cd /home/vscode/workspaces/idpbuilder-push-oci/efforts/phase1/wave2/E1.2.1-command-structure
```

### Step 2: Verify Current State
```bash
# Find all PushCmd declarations
grep -rn "var PushCmd" pkg/cmd/push/

# Should show TWO files if bug exists
```

### Step 3: Remove Duplicate File
```bash
# Option A: Delete push.go (if no other useful code)
git rm pkg/cmd/push/push.go

# Option B: If push.go has useful code, extract it first
# Review push.go for any unique functionality
# Merge useful parts into root.go
# Then delete push.go
```

### Step 4: Verify Fix Locally
```bash
# Try to build
go build ./pkg/cmd/push/

# Should compile without "PushCmd redeclared" error
```

### Step 5: Commit and Push
```bash
git add pkg/cmd/push/
git commit -m "fix(BUG-001): remove duplicate PushCmd declaration in push.go

- Removed pkg/cmd/push/push.go which duplicated PushCmd declaration
- root.go is the canonical location for PushCmd
- Resolves BUG-cascade-20251005-013208-001

Cascade-ID: cascade-20251005-013208"

git push
```

## Validation Steps

### Build Validation
```bash
# Navigate to effort directory
cd /home/vscode/workspaces/idpbuilder-push-oci/efforts/phase1/wave2/E1.2.1-command-structure

# Clean build
go clean ./...

# Build the package
go build ./pkg/cmd/push/

# Expected: No errors, successful compilation
```

### Grep Validation
```bash
# Verify only ONE PushCmd declaration exists
grep -rn "var PushCmd" pkg/cmd/push/

# Expected output (ONE line only):
# pkg/cmd/push/root.go:13:var PushCmd = &cobra.Command{
```

### Integration Test
```bash
# After fix is pushed, integration agent will verify
# Build should pass in Wave 2 integration workspace
```

## Critical Notes

### R362 Compliance
- **NO architectural changes** - just removing duplicate
- **NO library changes** - keeping existing structure
- **NO pattern changes** - maintaining cobra command pattern

### R383 Compliance
- This fix plan is in `.software-factory/` with timestamp
- Fix will be in production code (`pkg/`)
- Clear separation maintained

### Minimal Change Principle
- Remove ONE file (push.go)
- Keep existing root.go unchanged
- No refactoring beyond fixing the duplicate

## Metadata

**Cascade ID**: cascade-20251005-013208
**Bug ID**: BUG-cascade-20251005-013208-001
**Effort ID**: E1.2.1-command-structure
**Phase**: 1
**Wave**: 2
**Created**: 2025-10-05T04:09:09Z
**Fix Approach**: Remove duplicate file
**Expected Lines Changed**: ~40 lines deleted
**Risk Level**: LOW (simple deletion)
**Testing Required**: Build validation

## Success Criteria

✅ Only ONE `var PushCmd` declaration in pkg/cmd/push/
✅ Build succeeds without redeclaration errors
✅ All PushCmd flags still present
✅ Command still functions as designed
✅ Integration workspace build passes

---

**Next Steps**: Assign to SW Engineer for implementation
