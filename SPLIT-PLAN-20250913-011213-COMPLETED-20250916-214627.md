# Split Plan for kind-cert-extraction Effort

## Executive Summary
**Date**: 2025-09-13 01:12:13  
**Reviewer**: code-reviewer-1757726063 (sole planner)  
**Current Size**: 3170 lines (396% of limit)  
**Required Splits**: 5  
**Target Size per Split**: ~620-680 lines  

## Size Violation Details
The kind-cert-extraction effort has grown to 3170 lines, significantly exceeding the 800-line limit. This comprehensive split plan divides the codebase into 5 logical, independently buildable chunks that each stay well under the limit.

## Split Strategy Overview

### Logical Separation Approach
The codebase has been analyzed and divided along clear functional boundaries:
1. **Core certificate functionality** - The foundation
2. **Kubernetes/Kind operations** - Cluster integration  
3. **Build and utilities** - Supporting functions
4. **CLI interface** - User interaction layer
5. **Controllers and integration** - Orchestration layer

### Implementation Order
Splits must be implemented sequentially due to dependencies:
```
Split 001 (Foundation) → Split 002 (Kind/K8s) → Split 003 (Build/Utils) → Split 004 (CLI) → Split 005 (Controllers)
```

## Detailed Split Assignments

### Split 001: Core Certificate Extraction (650 lines)
- **Components**: pkg/certs/, foundation files
- **Purpose**: Certificate extraction core functionality
- **Dependencies**: None (foundational)
- **Branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-001`

### Split 002: Kind Cluster Integration (680 lines)
- **Components**: pkg/kind/, pkg/k8s/
- **Purpose**: Kubernetes and Kind cluster operations
- **Dependencies**: Split 001
- **Branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-002`

### Split 003: Build and Utilities (620 lines)
- **Components**: pkg/build/, pkg/util/
- **Purpose**: Build operations and utility functions
- **Dependencies**: Splits 001-002
- **Branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-003`

### Split 004: CLI Commands (600 lines)
- **Components**: pkg/cmd/, main.go
- **Purpose**: Complete command-line interface
- **Dependencies**: Splits 001-003
- **Branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-004`

### Split 005: Controllers and Integration (620 lines)
- **Components**: pkg/controllers/, api/, remaining packages
- **Purpose**: Controllers, API types, final integration
- **Dependencies**: All previous splits
- **Branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-005`

## File Distribution Matrix

| Package/File | Split 1 | Split 2 | Split 3 | Split 4 | Split 5 |
|-------------|---------|---------|---------|---------|---------|
| pkg/certs/ | ✅ | ❌ | ❌ | ❌ | ❌ |
| pkg/kind/ | ❌ | ✅ | ❌ | ❌ | ❌ |
| pkg/k8s/ | ❌ | ✅ | ❌ | ❌ | ❌ |
| pkg/build/ | ❌ | ❌ | ✅ | ❌ | ❌ |
| pkg/util/ | ❌ | ❌ | ✅ | ❌ | ❌ |
| pkg/cmd/ | ❌ | ❌ | ❌ | ✅ | ❌ |
| main.go | ❌ | ❌ | ❌ | ✅ | ❌ |
| pkg/controllers/ | ❌ | ❌ | ❌ | ❌ | ✅ |
| api/ | ❌ | ❌ | ❌ | ❌ | ✅ |
| globals/ | ❌ | ❌ | ❌ | ❌ | ✅ |
| go.mod/go.sum | ✅ | ✅ | ✅ | ✅ | ✅ |
| Makefile | ✅ | ✅ | ✅ | ✅ | ✅ |

## Implementation Process

### For Each Split:
1. **Create split directory**: `efforts/phase1/wave1/kind-cert-extraction/split-XXX/`
2. **Initialize git branch**: `idpbuilder-oci-build-push/phase1/wave1/kind-cert-extraction-split-XXX`
3. **Copy assigned files** from the file distribution matrix
4. **Implement functionality** according to split plan
5. **Measure with line counter**: `$PROJECT_ROOT/tools/line-counter.sh`
6. **Verify size compliance**: Must be <800 lines
7. **Run tests**: Ensure >80% coverage
8. **Submit for review**: Each split gets independent review

### Sequential Workflow:
```bash
# Split 001
implement_split_001() {
  # Implement core cert extraction
  # No dependencies
  # Submit for review
}

# Split 002 (after 001 approved)
implement_split_002() {
  # Merge Split 001
  # Implement Kind/K8s operations
  # Submit for review
}

# Continue sequentially...
```

## Size Compliance Verification

Each split MUST be verified with:
```bash
cd efforts/phase1/wave1/kind-cert-extraction/split-XXX
$PROJECT_ROOT/tools/line-counter.sh
# Must show <800 lines (target <700)
```

## Quality Requirements
- ✅ No stub implementations (R320)
- ✅ Each split builds independently
- ✅ Test coverage >80% per split
- ✅ Feature flags for graceful degradation
- ✅ Proper error handling throughout
- ✅ Documentation for public APIs

## Success Metrics
- All 5 splits under 800 lines each
- Total functionality preserved
- No code duplication between splits
- Clean dependency chain
- Each split independently reviewable
- Final integration produces working binary

## References
- SPLIT-INVENTORY-20250913-011213.md - Master inventory
- SPLIT-PLAN-001-20250913-011213.md - Split 001 details
- SPLIT-PLAN-002-20250913-011213.md - Split 002 details
- SPLIT-PLAN-003-20250913-011213.md - Split 003 details
- SPLIT-PLAN-004-20250913-011213.md - Split 004 details
- SPLIT-PLAN-005-20250913-011213.md - Split 005 details

## Next Steps
1. Orchestrator assigns SW Engineers to implement splits sequentially
2. Each split gets independent code review
3. Splits are integrated after all reviews pass
4. Final validation of complete functionality