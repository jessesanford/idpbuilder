# Split Plan for gitea-registry-client

**Code Reviewer**: code-reviewer
**Effort**: E2.1.2 - gitea-registry-client
**Current Size**: 1151 lines (351 over 800 limit)
**Created**: 2025-09-02 23:19:20 UTC
**Status**: SPLIT REQUIRED

## üö® CRITICAL SITUATION SUMMARY

The gitea-registry-client implementation is functionally complete but exceeds the 800-line limit by 351 lines. The implementation includes:
- ‚úÖ Complete registry client interface
- ‚úÖ Full Gitea implementation with Phase 1 certificate integration
- ‚úÖ Authentication mechanisms
- ‚úÖ Transport configuration
- ‚úÖ Feature flag support (R307 compliant)

## üìä SPLIT STRATEGY OVERVIEW

### Approach: Trim + Extend
Instead of splitting the existing code into two separate efforts, we will:
1. **TRIM** the main effort to fit under 800 lines (~750 target)
2. **CREATE** split-001 for the extracted components and tests

### Split Distribution

| Split | Type | Size | Content | Priority |
|-------|------|------|---------|----------|
| **Main Effort** | TRIM EXISTING | ~750 lines | Core client (trimmed) | P1 - Immediate |
| **Split-001** | NEW WORK | ~595 lines | Transport, utilities, tests | P2 - After trim |

## üìã ORCHESTRATOR ACTION ITEMS

### 1. Phase 1: Trim Main Effort (IMMEDIATE)
```bash
# Spawn SW Engineer to trim existing implementation
TASK: Trim gitea-registry-client to under 800 lines
BRANCH: idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client (EXISTING)
PLAN: SPLIT-PLAN-MAIN-20250902-231920.md
TARGET: ~750 lines
```

**SW Engineer Actions**:
- Consolidate error types in client.go
- Simplify gitea_client.go (remove verbose logging, consolidate error handling)
- Remove transport.go entirely (moves to split-001)
- Trim options.go to essentials only
- Verify compilation still works

### 2. Phase 2: Implement Split-001 (AFTER TRIM)
```bash
# Create split infrastructure
mkdir -p efforts/phase2/wave1/gitea-registry-client/split-001
cd efforts/phase2/wave1/gitea-registry-client/split-001
git checkout -b idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client-split-001

# Spawn SW Engineer for split work
TASK: Implement transport layer and tests
BRANCH: idpbuilder-oci-go-cr/phase2/wave1/gitea-registry-client-split-001
PLAN: SPLIT-PLAN-001-20250902-231920.md
TARGET: ~595 lines
```

**SW Engineer Actions**:
- Implement transport.go (from main effort)
- Create helper utilities
- Write comprehensive unit tests
- Initialize Go module
- Verify all tests pass

## üéØ SUCCESS CRITERIA

### Main Effort Trimming Success:
- ‚úÖ Size reduced to ~750 lines (under 800)
- ‚úÖ All core functionality preserved
- ‚úÖ Code still compiles
- ‚úÖ Feature flags maintained (R307)
- ‚úÖ Phase 1 integration intact

### Split-001 Success:
- ‚úÖ Size ~595 lines (under 800)
- ‚úÖ Transport layer complete
- ‚úÖ All tests passing
- ‚úÖ >80% code coverage
- ‚úÖ Go module initialized

## üîÑ EXECUTION SEQUENCE

```mermaid
graph LR
    A[Current: 1151 lines] --> B[Trim Main to ~750]
    B --> C[Verify Compilation]
    C --> D[Create Split-001 Infra]
    D --> E[Implement Split-001]
    E --> F[Both Under 800 lines]
```

## ‚ö†Ô∏è CRITICAL REMINDERS

1. **R199 Compliance**: This code reviewer is the SOLE planner for ALL splits
2. **R307 Compliance**: Feature flags MUST be preserved in main effort
3. **R221 Compliance**: All operations MUST cd to correct directory first
4. **Size Measurement**: Use line-counter.sh with correct base branch

## üìÅ DELIVERABLES

Created planning documents:
1. `SPLIT-INVENTORY-20250902-231920.md` - Complete split inventory
2. `SPLIT-PLAN-MAIN-20250902-231920.md` - Instructions for trimming main
3. `SPLIT-PLAN-001-20250902-231920.md` - Instructions for split-001
4. `SPLIT-PLAN-20250902-231920.md` - This summary document

## üöÄ NEXT STEPS FOR ORCHESTRATOR

1. **IMMEDIATE**: Spawn SW Engineer to trim main effort
2. **MONITOR**: Verify main effort reaches ~750 lines
3. **THEN**: Create split-001 infrastructure
4. **SPAWN**: SW Engineer for split-001 implementation
5. **REVIEW**: Both efforts with Code Reviewer
6. **INTEGRATE**: Merge both to wave integration branch

---

**IMPORTANT**: The main effort trimming is CRITICAL PATH. It must be completed before split-001 can begin, as split-001 will contain the components removed from main.

**Time Estimate**:
- Main effort trimming: 1-2 hours
- Split-001 implementation: 2-3 hours
- Total: 3-5 hours to complete both